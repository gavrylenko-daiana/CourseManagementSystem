@using Core.Models;
@using System.Web
@using System.Text
@model AssignmentAnswer

@{
    var fileExtension = Model.FileExtension.ToLower();
    var supportedImageExtensions = new[] { ".jpg", ".jpeg", ".png", ".gif", ".bmp", ".heic" };
    var supportedTextExtensions = new[] { ".html", ".js", ".css", ".txt", ".cs", ".cpp" };
    var supportedVideoExtensions = new[] { ".mp4", ".avi", ".mkv", ".mov" };
    var supportedPdfExtensions = new[] { ".pdf" };
    var supportedWordExtensions = new[] { ".doc", ".docx" };
    var supportedArchiveExtensions = new[] { ".zip", ".rar" };
}

<!DOCTYPE html>
<html>
<body>
<h3>File Details: @Model.Name</h3>

@if (supportedImageExtensions.Contains(fileExtension))
{
    <img src="@Model.Url" alt="Image" style="max-width: 100%;">
}
else if (supportedVideoExtensions.Contains(fileExtension))
{
    <video controls style="max-width: 100%;">
        <source src="@Model.Url" type="video/mp4">
        Your browser does not support the video tag.
    </video>
}
else if (supportedPdfExtensions.Contains(fileExtension))
{
    @* <div id="pdf-container"> *@
    @*     <embed src="@url" type="application/pdf" width="100%" height="600px"/> *@
    @*     <script> *@
    @*       var pdfUrl = "@url"; *@
    @*       var container = document.getElementById("pdf-container"); *@
    @*       PDFObject.embed(pdfUrl, container); *@
    @*     </script> *@
    @* </div> *@

    <div id="pdf-container">
        <object data="@Model.Url" type="application/pdf" width="100%" height="600px">
            <p>Your browser does not support displaying PDF files. You can <a href="@Model.Url">download file here</a>.</p>
        </object>
    </div>
}
else if (supportedWordExtensions.Contains(fileExtension))
{
    <p>Your browser does not support displaying WORD files. You can <a href="@Model.Url">download file here</a>.</p>
    @* <div id="word-container"> *@
    @*     <iframe src="https://docs.google.com/gview?url=@Model.Url&embedded=true" style="width: 100%; height: 600px;"></iframe> *@
    @* </div> *@
    @* <br> <hr/> *@
    @* <iframe src="https://view.officeapps.live.com/op/view.aspx?src=@Model.Url" style="width: 100%; height: 600px;"></iframe> *@
    @* *@
    @* <iframe src="https://docs.google.com/gview?url=@Model.Url&embedded=true" style="width: 100%; height: 600px;"></iframe> *@
    @* *@
    @* <div id="word-container" style="width: 100%; height: 600px;"></div> *@
    @* <script> *@
    @*     var wordUrl = "@Model.Url"; *@
    @*     var wordContainer = document.getElementById("word-container"); *@
    @* *@
    @*     var webViewerFrame = document.createElement("iframe"); *@
    @*     webViewerFrame.style.width = "100%"; *@
    @*     webViewerFrame.style.height = "100%"; *@
    @*     webViewerFrame.src = "https://view.officeapps.live.com/op/embed.aspx?src=" + encodeURIComponent(wordUrl); *@
    @* *@
    @*     wordContainer.appendChild(webViewerFrame); *@
    @* </script> *@
}
else if (supportedArchiveExtensions.Contains(fileExtension))
{
    <p>This is an archive file. You can <a href="@Model.Url">download file here</a>.</p>
    @* <a href="@url" class="btn btn-primary" download>Download</a> *@
}
else if (supportedTextExtensions.Contains(fileExtension))
{
    using (HttpClient httpClient = new HttpClient())
    {
        try
        {
            HttpResponseMessage response = await httpClient.GetAsync(Model.Url);
            response.EnsureSuccessStatusCode();

            string content = await response.Content.ReadAsStringAsync();

            <div class="ui segment">
                <pre>
                    <code class="language-@fileExtension">
                        @Html.Raw(HttpUtility.HtmlEncode(content))
                    </code>
                </pre>
            </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
            <script>
                hljs.initHighlightingOnLoad();
            </script>
        }
        catch (HttpRequestException ex)
        {
            throw new Exception(ex.Message);
        }
    }
}
else
{
    <p>You can <a href="@Model.Url">download file here</a>.</p>
}

@if (TempData["Error"] != null)
{
    <div class="ui negative message">
        <p><b>Sorry!</b> - @TempData["Error"]</p>
    </div>
}

</body>
</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.7/pdfobject.min.js"></script>